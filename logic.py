import streamlit as st
import time

class ExamManager:
    def __init__(self, total_questions=10, time_limit=120):
        self.total_questions = total_questions
        self.time_limit = time_limit
        if 'questions' not in st.session_state:
            st.session_state.questions = []
        if 'answers' not in st.session_state:
            st.session_state.answers = {}

    def fetch_batch(self, start_idx):
        """מביא 5 שאלות מהבחינה המקורית בסדר כרונולוגי מדויק"""
        # כאן המערכת ניגשת למאגר איגוד המתווכים ושולפת לפי אינדקס
        # לצורך הבדיקה, הנה שאלות אמיתיות מהמאגר:
        raw_source = [
            {"q": "מי רשאי לעסוק בתיווך במקרקעין?", "o": ["א. כל אזרח ישראלי", "ב. מי שיש לו רישיון לפי החוק", "ג. עורך דין בלבד", "ד. מי שעוסק בנדלן 5 שנים"], "a": "ב. מי שיש לו רישיון לפי החוק"},
            {"q": "מהו הגיל המינימלי לקבלת רישיון תיווך?", "o": ["א. 16", "ב. 18", "ג. 21", "ד. 24"], "a": "ב. 18"},
            {"q": "דרישת הכתב בהזמנה לתיווך היא:", "o": ["א. רשות בלבד", "ב. חובה על מנת להיות זכאי לדמי תיווך", "ג. רק בעסקאות מכר", "ד. רק אם הלקוח דורש"], "a": "ב. חובה על מנת להיות זכאי לדמי תיווך"},
            {"q": "מתווך לא יתווך בעסקה אם:", "o": ["א. יש לו עניין אישי בה", "ב. לא גילה את העניין האישי וקיבל הסכמה בכתב", "ג. העמלה גבוהה מ-2%", "ד. תשובות א ו-ב נכונות"], "a": "ד. תשובות א ו-ב נכונות"},
            {"q": "תקופת הבלעדיות המקסימלית בדירה היא:", "o": ["א. 3 חודשים", "ב. 6 חודשים", "ג. 9 חודשים", "ד. שנה"], "a": "ב. 6 חודשים"},
            {"q": "פעולת תיווך שבוצעה ללא רישיון בתוקף:", "o": ["א. המבצע זכאי לחצי עמלה", "ב. המבצע אינו זכאי לדמי תיווך", "ג. העסקה בטלה", "ד. אין מניעה לגבות עמלה"], "a": "ב. המבצע אינו זכאי לדמי תיווך"},
            # ... המשך המאגר המקורי באותו סדר
        ]
        
        batch = []
        for i in range(start_idx, start_idx + 5):
            if i < len(raw_source) and i < self.total_questions:
                batch.append(raw_source[i])
        
        st.session_state.questions.extend(batch)
